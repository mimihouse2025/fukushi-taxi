<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>福祉タクシー利用料</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1Y1geobXRlk517MSj_b3dEl9o1wZjKSs&libraries=places" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, select, button { width: 100%; padding: 8px; margin: 10px 0; box-sizing: border-box; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    .radio-group { margin-bottom: 15px; }
    .radio-group label { font-weight: normal; margin-left: 20px; display: inline-block; }
    #result, #details, #breakdown { margin-top: 20px; font-weight: bold; }
    #breakdown ul { padding-left: 20px; }
    #invoice { font-size: 14px; page-break-inside: avoid; }
    .invoice-block { border: 1px solid #000; padding: 10px; margin-bottom: 20px; }
    .invoice-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
    .invoice-title { font-size: 18px; font-weight: bold; text-align: center; margin-bottom: 10px; }
    .invoice-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .invoice-table th, .invoice-table td { border: 1px solid #000; padding: 4px; text-align: left; }
  </style>
</head>
<body>
  <!-- (同じ入力フォーム部分を省略) -->
  <script>
    let distanceKmGlobal = 0;
    let globalOrigin = "";
    let globalDestination = "";

    function calculateFare() {
      const origin = document.getElementById("origin").value;
      const destination = document.getElementById("destination").value;
      globalOrigin = origin;
      globalDestination = destination;
      // (残りのcalculateFare関数は元のまま)
      // document.getElementById("breakdown").innerHTML = `<h4>内訳</h4><ul><li>${breakdown.join('</li><li>')}</li></ul>`;
      document.getElementById("breakdown").innerHTML = `<h4>内訳</h4><ul><li>出発地：${origin}</li><li>目的地：${destination}</li><li>${breakdown.join('</li><li>')}</li></ul>`;
    }

    function generatePDF() {
      const breakdownList = document.querySelector('#breakdown ul');
      if (!breakdownList) {
        alert('先に「運賃を計算する」を実行してください。');
        return;
      }
      const tableHTML = `<tr><td>出発地：${globalOrigin}</td></tr>` +
                        `<tr><td>目的地：${globalDestination}</td></tr>` +
                        Array.from(breakdownList.children).map(item => `<tr><td>${item.innerText}</td></tr>`).join('') +
                        `<tr><td><strong>走行距離：${distanceKmGlobal.toFixed(2)} km</strong></td></tr>` +
                        `<tr><td><strong>` + document.getElementById("result").innerText + `</strong></td></tr>`;
      const fullTable = `<tr><th>内訳明細</th></tr>` + tableHTML;

      document.getElementById("invoice-table").innerHTML = fullTable;
      document.getElementById("invoice-table-copy").innerHTML = fullTable;

      const element = document.getElementById("invoice");
      element.style.display = "block";
      html2pdf().set({
        margin: 10,
        filename: '福祉タクシー請求書_領収書.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).from(element).save().then(() => {
        element.style.display = "none";
      });
    }
  </script>
</body>
</html>
